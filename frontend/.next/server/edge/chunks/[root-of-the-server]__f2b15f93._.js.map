{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport * as jose from \"jose\"; \r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"segredo_super\";\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  const { pathname } = req.nextUrl;\r\n\r\n  // Rotas públicas\r\n  if (\r\n    [\"/login\", \"/register\", \"/favicon.ico\"].includes(pathname) ||\r\n    pathname.startsWith(\"/_next\") ||\r\n    pathname.startsWith(\"/api/auth\") ||\r\n    pathname.startsWith(\"/static\") ||\r\n    pathname.startsWith(\"/favicon\") ||\r\n    pathname.startsWith(\"/dilithium.wasm\") ||\r\n    pathname.match(/\\.(svg|png|jpg|jpeg|gif|ico|js|css|wasm)$/)\r\n  ) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Pega token do cookie HttpOnly\r\n  const token = req.cookies.get(\"jwt\")?.value;\r\n\r\n  if (!token) {\r\n    return NextResponse.redirect(new URL(\"/login\", req.url));\r\n  }\r\n\r\n  try {\r\n    const secret = new TextEncoder().encode(JWT_SECRET);\r\n    \r\n    // jwtVerify valida expiração automaticamente\r\n    await jose.jwtVerify(token, secret, {\r\n      clockTolerance: 0, // Não permite margem de tempo para tokens expirados\r\n    });\r\n\r\n    // Se passou, segue\r\n    return NextResponse.next();\r\n  } catch (err) {\r\n    // jose.jwtVerify já lança erro para tokens expirados, mas vamos logar especificamente\r\n    if (err instanceof jose.errors.JWTExpired || (err as any).code === 'ERR_JWT_EXPIRED') {\r\n      console.error(\"Token expirado:\", err);\r\n    } else {\r\n      console.error(\"Token inválido:\", err);\r\n    }\r\n    return NextResponse.redirect(new URL(\"/login\", req.url));\r\n  }\r\n}\r\n\r\nexport const config = {\r\n  // Aplica a todas as rotas, exceto login, register, api, next, favicon\r\n  matcher: [\"/((?!login|register|api|_next|favicon.ico).*)\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AAAA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,WAAW,GAAgB;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,iBAAiB;IACjB,IACE;QAAC;QAAU;QAAa;KAAe,CAAC,QAAQ,CAAC,aACjD,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,gBACpB,SAAS,UAAU,CAAC,cACpB,SAAS,UAAU,CAAC,eACpB,SAAS,UAAU,CAAC,sBACpB,SAAS,KAAK,CAAC,8CACf;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,gCAAgC;IAChC,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ;IAEtC,IAAI,CAAC,OAAO;QACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,IAAI;QACF,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC;QAExC,6CAA6C;QAC7C,MAAM,4KAAc,CAAC,OAAO,QAAQ;YAClC,gBAAgB;QAClB;QAEA,mBAAmB;QACnB,OAAO,gMAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,KAAK;QACZ,sFAAsF;QACtF,IAAI,eAAe,4MAAW,CAAC,UAAU,IAAI,AAAC,IAAY,IAAI,KAAK,mBAAmB;YACpF,QAAQ,KAAK,CAAC,mBAAmB;QACnC,OAAO;YACL,QAAQ,KAAK,CAAC,mBAAmB;QACnC;QACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;AACF;AAEO,MAAM,SAAS;IACpB,sEAAsE;IACtE,SAAS;QAAC;KAAgD;AAC5D"}}]
}