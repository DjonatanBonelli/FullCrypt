{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/shared/handlers/handlers.ts"],"sourcesContent":["export const aceitarCompartilhamento = async (id: number) => {\r\n  await fetch(`/api/shared/${id}/aceitar`, { method: \"POST\", credentials: \"include\" });\r\n  return { id, status: \"aceito\" };\r\n};\r\n\r\nexport const recusarCompartilhamento = async (id: number) => {\r\n  await fetch(`/api/shared/${id}/recusar`, { method: \"POST\", credentials: \"include\" });\r\n  return { id, status: \"recusado\" };\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,0BAA0B,OAAO;IAC5C,MAAM,MAAM,CAAC,YAAY,EAAE,GAAG,QAAQ,CAAC,EAAE;QAAE,QAAQ;QAAQ,aAAa;IAAU;IAClF,OAAO;QAAE;QAAI,QAAQ;IAAS;AAChC;AAEO,MAAM,0BAA0B,OAAO;IAC5C,MAAM,MAAM,CAAC,YAAY,EAAE,GAAG,QAAQ,CAAC,EAAE;QAAE,QAAQ;QAAQ,aAAa;IAAU;IAClF,OAAO;QAAE;QAAI,QAAQ;IAAW;AAClC","debugId":null}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/crypto/hpke-kem.ts"],"sourcesContent":["import { Aes256Gcm, CipherSuite, HkdfSha256 } from \"@hpke/core\";\r\nimport { MlKem768 } from \"@hpke/ml-kem\";\r\n\r\n// === Encode / Decode base64url ===\r\nexport function b64uEncode(buf: Uint8Array) {\r\n  return Buffer.from(buf)\r\n    .toString(\"base64\")\r\n    .replace(/\\+/g, \"-\")\r\n    .replace(/\\//g, \"_\")\r\n    .replace(/=+$/, \"\");\r\n}\r\n\r\nexport function b64uDecode(s: string) {\r\n  return Uint8Array.from(Buffer.from(s.replace(/-/g, \"+\").replace(/_/g, \"/\"), \"base64\"));\r\n}\r\n\r\n// === Criar CipherSuite ===\r\nasync function makeSuite() {\r\n  return new CipherSuite({\r\n    kem: new MlKem768(),\r\n    kdf: new HkdfSha256(),\r\n    aead: new Aes256Gcm(),\r\n  });\r\n}\r\n\r\n// === Gerar par de chaves HPKE ===\r\nexport async function generateHpkeKeyPair() {\r\n  const suite = await makeSuite();\r\n  const { privateKey, publicKey } = await suite.kem.generateKeyPair();\r\n\r\n  console.log(\"Private Key:\", privateKey);\r\n  console.log(\"Public Key:\", publicKey);\r\n\r\n  // Pegamos apenas o Uint8Array interno\r\n  return {\r\n    privateKey: Array.from(privateKey.key),\r\n    publicKey: Array.from(publicKey.key),\r\n  };\r\n}\r\n\r\n// === Criptografa bytes com chave p√∫blica (raw bytes) ===\r\nexport async function encryptBytesWithHpke(pubBytes: Uint8Array, plaintext: Uint8Array) {\r\n  const suite = await makeSuite();\r\n  const pk = await suite.kem.importKey(\"raw\", pubBytes, true); // public key raw\r\n  const sender = await suite.createSenderContext({ recipientPublicKey: pk });\r\n\r\n  const ciphertext = await sender.seal(plaintext);\r\n  const enc = sender.enc;\r\n\r\n  return {\r\n    enc: b64uEncode(enc),\r\n    ciphertext: ciphertext,\r\n    aead: \"Aes256Gcm\",\r\n    kem: \"MlKem768\",\r\n  };\r\n}\r\n\r\n// === Descriptografa bytes com chave privada (raw bytes) ===\r\nexport async function decryptBytesWithHpke(\r\n  privBytes: Uint8Array,\r\n  enc: Uint8Array,            \r\n  ciphertext: Uint8Array   \r\n) {\r\n\r\n  //console.log(privBytes.length, enc.length, ciphertext.length);\r\n  //console.log(enc);\r\n\r\n  const suite = await makeSuite();\r\n  const sk = await suite.kem.importKey(\"raw\", privBytes, false); \r\n\r\n  const recipient = await suite.createRecipientContext({\r\n    recipientKey: sk,\r\n    enc: enc,\r\n  });\r\n\r\n  const plaintext = await recipient.open(ciphertext); \r\n  return new Uint8Array(plaintext);\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AAAA;AACA;AAAA;;;AAGO,SAAS,WAAW,GAAe;IACxC,OAAO,OAAO,IAAI,CAAC,KAChB,QAAQ,CAAC,UACT,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,OAAO;AACpB;AAEO,SAAS,WAAW,CAAS;IAClC,OAAO,WAAW,IAAI,CAAC,OAAO,IAAI,CAAC,EAAE,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM,MAAM;AAC9E;AAEA,4BAA4B;AAC5B,eAAe;IACb,OAAO,IAAI,qKAAW,CAAC;QACrB,KAAK,IAAI,sKAAQ;QACjB,KAAK,IAAI,oKAAU;QACnB,MAAM,IAAI,4KAAS;IACrB;AACF;AAGO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,MAAM,MAAM,GAAG,CAAC,eAAe;IAEjE,QAAQ,GAAG,CAAC,gBAAgB;IAC5B,QAAQ,GAAG,CAAC,eAAe;IAE3B,sCAAsC;IACtC,OAAO;QACL,YAAY,MAAM,IAAI,CAAC,WAAW,GAAG;QACrC,WAAW,MAAM,IAAI,CAAC,UAAU,GAAG;IACrC;AACF;AAGO,eAAe,qBAAqB,QAAoB,EAAE,SAAqB;IACpF,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,MAAM,MAAM,GAAG,CAAC,SAAS,CAAC,OAAO,UAAU,OAAO,iBAAiB;IAC9E,MAAM,SAAS,MAAM,MAAM,mBAAmB,CAAC;QAAE,oBAAoB;IAAG;IAExE,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC;IACrC,MAAM,MAAM,OAAO,GAAG;IAEtB,OAAO;QACL,KAAK,WAAW;QAChB,YAAY;QACZ,MAAM;QACN,KAAK;IACP;AACF;AAGO,eAAe,qBACpB,SAAqB,EACrB,GAAe,EACf,UAAsB;IAGtB,+DAA+D;IAC/D,mBAAmB;IAEnB,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,MAAM,MAAM,GAAG,CAAC,SAAS,CAAC,OAAO,WAAW;IAEvD,MAAM,YAAY,MAAM,MAAM,sBAAsB,CAAC;QACnD,cAAc;QACd,KAAK;IACP;IAEA,MAAM,YAAY,MAAM,UAAU,IAAI,CAAC;IACvC,OAAO,IAAI,WAAW;AACxB","debugId":null}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/handlers/downloadFileHandlers.ts"],"sourcesContent":["// handleDownload.ts\r\nimport { b64uDecode, decryptBytesWithHpke } from \"../crypto/hpke-kem\";\r\n\r\nexport const handleDownload = async (\r\n  arquivo: { arquivo_id: number; arquivo_nome: string; chave_encrypted: string },\r\n  userPrivKey: string, // j√° convertido para bytes\r\n  setStatus?: (msg: string) => void\r\n) => {\r\n  if (!userPrivKey) return alert(\"Informe a chave privada para descriptografar!\");\r\n\r\n  try {\r\n    // Faz o fetch do arquivo criptografado como bytes\r\n    const res = await fetch(`/api/download/${arquivo.arquivo_id}`, { credentials: \"include\" });\r\n    if (!res.ok) throw new Error(\"Erro ao baixar arquivo\");\r\n\r\n    const userPrivKeyBytes = b64uDecode(userPrivKey);\r\n    const encBytes = b64uDecode(arquivo.chave_encrypted);\r\n\r\n    const encryptedBytes = new Uint8Array(await res.arrayBuffer()); // BYTEA do backend\r\n\r\n    // Descriptografa usando HPKE\r\n    const decrypted = await decryptBytesWithHpke(userPrivKeyBytes, encBytes, encryptedBytes);\r\n\r\n    // Cria Blob e baixa\r\n    const blob = new Blob([decrypted]);\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = arquivo.arquivo_nome;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    a.remove();\r\n    URL.revokeObjectURL(url);\r\n  } catch (err) {\r\n    console.error(err);\r\n    if (setStatus) setStatus(\"Erro ao descriptografar arquivo\");\r\n  }\r\n};\r\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AACpB;;AAEO,MAAM,iBAAiB,OAC5B,SACA,aACA;IAEA,IAAI,CAAC,aAAa,OAAO,MAAM;IAE/B,IAAI;QACF,kDAAkD;QAClD,MAAM,MAAM,MAAM,MAAM,CAAC,cAAc,EAAE,QAAQ,UAAU,EAAE,EAAE;YAAE,aAAa;QAAU;QACxF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;QAE7B,MAAM,mBAAmB,IAAA,0IAAU,EAAC;QACpC,MAAM,WAAW,IAAA,0IAAU,EAAC,QAAQ,eAAe;QAEnD,MAAM,iBAAiB,IAAI,WAAW,MAAM,IAAI,WAAW,KAAK,mBAAmB;QAEnF,6BAA6B;QAC7B,MAAM,YAAY,MAAM,IAAA,oJAAoB,EAAC,kBAAkB,UAAU;QAEzE,oBAAoB;QACpB,MAAM,OAAO,IAAI,KAAK;YAAC;SAAU;QACjC,MAAM,MAAM,IAAI,eAAe,CAAC;QAChC,MAAM,IAAI,SAAS,aAAa,CAAC;QACjC,EAAE,IAAI,GAAG;QACT,EAAE,QAAQ,GAAG,QAAQ,YAAY;QACjC,SAAS,IAAI,CAAC,WAAW,CAAC;QAC1B,EAAE,KAAK;QACP,EAAE,MAAM;QACR,IAAI,eAAe,CAAC;IACtB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,IAAI,WAAW,UAAU;IAC3B;AACF","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/crypto/dilithium.ts"],"sourcesContent":["\"use client\";\r\n\r\nexport async function getDilithium() {\r\n  const { createDilithium } = await import(\"dilithium-crystals-js\");\r\n\r\n  return await createDilithium({\r\n    wasmPath: \"/dilithium.wasm\",\r\n    locateFile: (file: string) => {\r\n      if (file.endsWith(\".wasm\")) return \"/dilithium.wasm\";\r\n      return file;\r\n    }\r\n  });\r\n}\r\n\r\nexport async function generateDilithiumKeyPair(kind: number) {\r\n  const d = await getDilithium();\r\n  return d.generateKeys(kind);\r\n}\r\n\r\nexport async function signWithDilithium(msg: Uint8Array, priv: Uint8Array, kind: number) {\r\n  const d = await getDilithium();\r\n  return d.sign(msg, priv, kind).signature;\r\n}\r\n\r\nexport async function verifyWithDilithium(sig: Uint8Array, msg: Uint8Array, pub: Uint8Array, kind: number) {\r\n  const d = await getDilithium();\r\n  return d.verify(sig, msg, pub, kind).result === 0;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AAEO,eAAe;IACpB,MAAM,EAAE,eAAe,EAAE,GAAG;IAE5B,OAAO,MAAM,gBAAgB;QAC3B,UAAU;QACV,YAAY,CAAC;YACX,IAAI,KAAK,QAAQ,CAAC,UAAU,OAAO;YACnC,OAAO;QACT;IACF;AACF;AAEO,eAAe,yBAAyB,IAAY;IACzD,MAAM,IAAI,MAAM;IAChB,OAAO,EAAE,YAAY,CAAC;AACxB;AAEO,eAAe,kBAAkB,GAAe,EAAE,IAAgB,EAAE,IAAY;IACrF,MAAM,IAAI,MAAM;IAChB,OAAO,EAAE,IAAI,CAAC,KAAK,MAAM,MAAM,SAAS;AAC1C;AAEO,eAAe,oBAAoB,GAAe,EAAE,GAAe,EAAE,GAAe,EAAE,IAAY;IACvG,MAAM,IAAI,MAAM;IAChB,OAAO,EAAE,MAAM,CAAC,KAAK,KAAK,KAAK,MAAM,MAAM,KAAK;AAClD","debugId":null}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/cloud/handlers/userHandlers.ts"],"sourcesContent":["import { b64uDecode } from \"@/app/crypto/hpke-kem\";\r\n\r\nexport const fetchUserPublicKey = async (email: string): Promise<Uint8Array | null> => {\r\n  const res = await fetch(`/api/users/pk?email=${encodeURIComponent(email)}`);\r\n  if (!res.ok) return null;\r\n  const data = await res.json();\r\n  return b64uDecode(data.pk_kyber), b64uDecode(data.pk_dilithium);\r\n};"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,qBAAqB,OAAO;IACvC,MAAM,MAAM,MAAM,MAAM,CAAC,oBAAoB,EAAE,mBAAmB,QAAQ;IAC1E,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IACpB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO,IAAA,0IAAU,EAAC,KAAK,QAAQ,GAAG,IAAA,0IAAU,EAAC,KAAK,YAAY;AAChE","debugId":null}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/shared/handlers/shareHandlers.ts"],"sourcesContent":["import { signWithDilithium } from \"@/app/crypto/dilithium\";\r\nimport { fetchUserPublicKey } from \"../../cloud/handlers/userHandlers\";\r\nimport { encryptBytesWithHpke } from \"../../crypto/hpke-kem\";\r\n\r\nexport const handleShare = async (\r\n  file: File,\r\n  targetEmail: string,\r\n  setStatus: (msg: string) => void\r\n) => {\r\n  try {\r\n    \r\n    const nonce = null;\r\n    \r\n    const fileBytes = new Uint8Array(await file.arrayBuffer());\r\n    setStatus(\"üîë Buscando chave p√∫blica do destinat√°rio...\");\r\n\r\n    const userKeys = (await fetchUserPublicKey(targetEmail)) as\r\n      | { pk_kyber?: Uint8Array; pk_dilithium?: Uint8Array }\r\n      | null;\r\n    if (!userKeys || !userKeys.pk_kyber || !userKeys.pk_dilithium)\r\n      throw new Error(\"Usu√°rio n√£o encontrado\");\r\n    const { pk_kyber, pk_dilithium } = userKeys;\r\n\r\n    // Criptografa\r\n    const { enc, ciphertext } = await encryptBytesWithHpke(pk_kyber, fileBytes);\r\n\r\n    const encBytes = new Uint8Array(Buffer.from(enc, \"base64\"));\r\n\r\n    const signature = signWithDilithium(encBytes, pk_dilithium, 2);\r\n\r\n    // Monta o form\r\n    const formData = new FormData();\r\n    formData.append(\"file\", new Blob([ciphertext]), file.name + \".enc\");\r\n    formData.append(\"nome_arquivo\", file.name);\r\n    formData.append(\"email\", targetEmail);\r\n    formData.append(\"chave_encrypted\", enc);\r\n    if (nonce) formData.append(\"nonce_file\", nonce);\r\n\r\n    setStatus(\"üì§ Enviando arquivo criptografado...\");\r\n    const res = await fetch(\"/api/share\", {\r\n      method: \"POST\",\r\n      credentials: \"include\",\r\n      body: formData,\r\n    });\r\n\r\n    if (res.ok) setStatus(\"‚úÖ Arquivo compartilhado com sucesso!\");\r\n    else {\r\n      const data = await res.json().catch(() => ({}));\r\n      setStatus(`‚ùå Erro: ${data.message || \"Falha ao compartilhar\"}`);\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Erro no compartilhamento:\", err);\r\n    setStatus(\"‚ùå Erro ao compartilhar arquivo\");\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,MAAM,cAAc,OACzB,MACA,aACA;IAEA,IAAI;QAEF,MAAM,QAAQ;QAEd,MAAM,YAAY,IAAI,WAAW,MAAM,KAAK,WAAW;QACvD,UAAU;QAEV,MAAM,WAAY,MAAM,IAAA,8JAAkB,EAAC;QAG3C,IAAI,CAAC,YAAY,CAAC,SAAS,QAAQ,IAAI,CAAC,SAAS,YAAY,EAC3D,MAAM,IAAI,MAAM;QAClB,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG;QAEnC,cAAc;QACd,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,GAAG,MAAM,IAAA,oJAAoB,EAAC,UAAU;QAEjE,MAAM,WAAW,IAAI,WAAW,OAAO,IAAI,CAAC,KAAK;QAEjD,MAAM,YAAY,IAAA,+IAAiB,EAAC,UAAU,cAAc;QAE5D,eAAe;QACf,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,QAAQ,IAAI,KAAK;YAAC;SAAW,GAAG,KAAK,IAAI,GAAG;QAC5D,SAAS,MAAM,CAAC,gBAAgB,KAAK,IAAI;QACzC,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,mBAAmB;QACnC;;QAEA,UAAU;QACV,MAAM,MAAM,MAAM,MAAM,cAAc;YACpC,QAAQ;YACR,aAAa;YACb,MAAM;QACR;QAEA,IAAI,IAAI,EAAE,EAAE,UAAU;aACjB;YACH,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YAC7C,UAAU,CAAC,QAAQ,EAAE,KAAK,OAAO,IAAI,yBAAyB;QAChE;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,UAAU;IACZ;AACF","debugId":null}},
    {"offset": {"line": 261, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/shared/components/ShareModal.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState } from \"react\";\r\nimport { handleShare } from \"../handlers/shareHandlers\";\r\n\r\ntype ShareModalProps = {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  setStatus: (msg: string) => void;\r\n};\r\n\r\nexport default function ShareModal({ isOpen, onClose, setStatus }: ShareModalProps) {\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [recipient, setRecipient] = useState(\"\");\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!file || !recipient) return;\r\n\r\n    // chama o handler centralizado\r\n    await handleShare(file, recipient, setStatus);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <div style={overlayStyle}>\r\n      <div style={modalStyle}>\r\n        <h3 style={{ marginBottom: 10 }}>Compartilhar arquivo</h3>\r\n        <form onSubmit={handleSubmit} style={{ display: \"flex\", flexDirection: \"column\", gap: \"10px\" }}>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Destinat√°rio (email)\"\r\n            value={recipient}\r\n            onChange={(e) => setRecipient(e.target.value)}\r\n            required\r\n            style={inputStyle}\r\n          />\r\n          <input\r\n            type=\"file\"\r\n            onChange={(e) => setFile(e.target.files?.[0] ?? null)}\r\n            required\r\n            style={inputStyle}\r\n          />\r\n          <div style={{ display: \"flex\", gap: \"8px\", marginTop: 10 }}>\r\n            <button type=\"submit\" style={buttonPrimary}>Enviar</button>\r\n            <button type=\"button\" style={buttonSecondary} onClick={onClose}>Cancelar</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ===== ESTILOS =====\r\n\r\nconst overlayStyle: React.CSSProperties = {\r\n  position: \"fixed\",\r\n  top: 0,\r\n  left: 0,\r\n  width: \"100vw\",\r\n  height: \"100vh\",\r\n  backgroundColor: \"rgba(0, 0, 0, 0.6)\",\r\n  display: \"flex\",\r\n  justifyContent: \"center\",\r\n  alignItems: \"center\",\r\n  zIndex: 1000,\r\n};\r\n\r\nconst modalStyle: React.CSSProperties = {\r\n  backgroundColor: \"#1e1e1e\",       // escuro pro tema dark\r\n  color: \"#f1f1f1\",                 // texto claro\r\n  padding: \"20px\",\r\n  borderRadius: \"8px\",\r\n  width: \"90%\",\r\n  maxWidth: \"400px\",\r\n  boxShadow: \"0 0 15px rgba(0,0,0,0.3)\",\r\n};\r\n\r\nconst inputStyle: React.CSSProperties = {\r\n  padding: \"8px\",\r\n  borderRadius: \"4px\",\r\n  border: \"1px solid #444\",\r\n  backgroundColor: \"#2a2a2a\",\r\n  color: \"#f1f1f1\",\r\n};\r\n\r\nconst buttonPrimary: React.CSSProperties = {\r\n  backgroundColor: \"#007bff\",\r\n  color: \"#fff\",\r\n  border: \"none\",\r\n  padding: \"8px 12px\",\r\n  borderRadius: \"4px\",\r\n  cursor: \"pointer\",\r\n};\r\n\r\nconst buttonSecondary: React.CSSProperties = {\r\n  backgroundColor: \"#444\",\r\n  color: \"#fff\",\r\n  border: \"none\",\r\n  padding: \"8px 12px\",\r\n  borderRadius: \"4px\",\r\n  cursor: \"pointer\",\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AAFA;;;;AAUe,SAAS,WAAW,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAmB;IAChF,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,IAAI,CAAC,QAAQ,CAAC,WAAW;QAEzB,+BAA+B;QAC/B,MAAM,IAAA,yJAAW,EAAC,MAAM,WAAW;QACnC;IACF;IAEA,qBACE,8OAAC;QAAI,OAAO;kBACV,cAAA,8OAAC;YAAI,OAAO;;8BACV,8OAAC;oBAAG,OAAO;wBAAE,cAAc;oBAAG;8BAAG;;;;;;8BACjC,8OAAC;oBAAK,UAAU;oBAAc,OAAO;wBAAE,SAAS;wBAAQ,eAAe;wBAAU,KAAK;oBAAO;;sCAC3F,8OAAC;4BACC,MAAK;4BACL,aAAY;4BACZ,OAAO;4BACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;4BAC5C,QAAQ;4BACR,OAAO;;;;;;sCAET,8OAAC;4BACC,MAAK;4BACL,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,IAAI;4BAChD,QAAQ;4BACR,OAAO;;;;;;sCAET,8OAAC;4BAAI,OAAO;gCAAE,SAAS;gCAAQ,KAAK;gCAAO,WAAW;4BAAG;;8CACvD,8OAAC;oCAAO,MAAK;oCAAS,OAAO;8CAAe;;;;;;8CAC5C,8OAAC;oCAAO,MAAK;oCAAS,OAAO;oCAAiB,SAAS;8CAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM5E;AAEA,sBAAsB;AAEtB,MAAM,eAAoC;IACxC,UAAU;IACV,KAAK;IACL,MAAM;IACN,OAAO;IACP,QAAQ;IACR,iBAAiB;IACjB,SAAS;IACT,gBAAgB;IAChB,YAAY;IACZ,QAAQ;AACV;AAEA,MAAM,aAAkC;IACtC,iBAAiB;IACjB,OAAO;IACP,SAAS;IACT,cAAc;IACd,OAAO;IACP,UAAU;IACV,WAAW;AACb;AAEA,MAAM,aAAkC;IACtC,SAAS;IACT,cAAc;IACd,QAAQ;IACR,iBAAiB;IACjB,OAAO;AACT;AAEA,MAAM,gBAAqC;IACzC,iBAAiB;IACjB,OAAO;IACP,QAAQ;IACR,SAAS;IACT,cAAc;IACd,QAAQ;AACV;AAEA,MAAM,kBAAuC;IAC3C,iBAAiB;IACjB,OAAO;IACP,QAAQ;IACR,SAAS;IACT,cAAc;IACd,QAAQ;AACV","debugId":null}},
    {"offset": {"line": 427, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/shared/components/CompartilhamentoItem.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\ntype Props = {\r\n  arquivoNome: string;\r\n  senderNome: string;\r\n  onAceitar?: () => void;\r\n  onRecusar?: () => void;\r\n};\r\n\r\nexport default function CompartilhamentoItem({ arquivoNome, senderNome, onAceitar, onRecusar }: Props) {\r\n    console.log(senderNome, \"quer compartilhar\", arquivoNome);\r\n  return (\r\n    <div style={{ marginBottom: \"1rem\" }}>\r\n      <span>{senderNome} quer compartilhar: {arquivoNome}</span>\r\n      {onAceitar && <button onClick={onAceitar}>Aceitar</button>}\r\n      {onRecusar && <button onClick={onRecusar}>Recusar</button>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AASe,SAAS,qBAAqB,EAAE,WAAW,EAAE,UAAU,EAAE,SAAS,EAAE,SAAS,EAAS;IACjG,QAAQ,GAAG,CAAC,YAAY,qBAAqB;IAC/C,qBACE,8OAAC;QAAI,OAAO;YAAE,cAAc;QAAO;;0BACjC,8OAAC;;oBAAM;oBAAW;oBAAqB;;;;;;;YACtC,2BAAa,8OAAC;gBAAO,SAAS;0BAAW;;;;;;YACzC,2BAAa,8OAAC;gBAAO,SAAS;0BAAW;;;;;;;;;;;;AAGhD","debugId":null}},
    {"offset": {"line": 478, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/shared/components/CompartilhamentoAceito.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\ntype Props = {\r\n  arquivoNome: string;\r\n  senderNome: string;\r\n};\r\n\r\nexport default function CompartilhamentoAceito({ arquivoNome, senderNome }: Props) {\r\n  return <div><span>{arquivoNome} de {senderNome}</span></div>;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAOe,SAAS,uBAAuB,EAAE,WAAW,EAAE,UAAU,EAAS;IAC/E,qBAAO,8OAAC;kBAAI,cAAA,8OAAC;;gBAAM;gBAAY;gBAAK;;;;;;;;;;;;AACtC","debugId":null}},
    {"offset": {"line": 507, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djonatan.bonelli/Documents/GitHub/FullCrypt/app/shared/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { aceitarCompartilhamento, recusarCompartilhamento } from \"./handlers/handlers\";\r\nimport { handleDownload } from \"../handlers/downloadFileHandlers\";\r\nimport ShareModal from \"./components/ShareModal\";\r\nimport CompartilhamentoItem from \"./components/CompartilhamentoItem\";\r\nimport CompartilhamentoAceito from \"./components/CompartilhamentoAceito\";\r\n\r\ntype Compartilhamento = {\r\n  id: number;\r\n  arquivo_nome: string;\r\n  sender_nome: string;\r\n  kyber_key: string;\r\n  status: \"pendente\" | \"aceito\" | \"recusado\";\r\n};\r\n\r\nexport default function Compartilhamentos() {\r\n  const [compartilhamentos, setCompartilhamentos] = useState<Compartilhamento[]>([]);\r\n  const [status, setStatus] = useState(\"\");\r\n  const [shareModalOpen, setShareModalOpen] = useState(false);\r\n  const [selectedFileId, setSelectedFileId] = useState<number | null>(null);\r\n\r\n  const openShareModal = (id: number) => {\r\n    setSelectedFileId(id);\r\n    setShareModalOpen(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/shared\", { credentials: \"include\" })\r\n      .then(res => res.json())\r\n      .then(data => setCompartilhamentos(data));\r\n  }, []);\r\n\r\n  const handleAceitar = async (id: number) => {\r\n    const result = await aceitarCompartilhamento(id);\r\n    setCompartilhamentos(prev =>\r\n      prev.map(c => (c.id === result.id ? { ...c, status: result.status } : c))\r\n    );\r\n  };\r\n\r\n  const handleRecusar = async (id: number) => {\r\n    const result = await recusarCompartilhamento(id);\r\n    setCompartilhamentos(prev =>\r\n      prev.map(c => (c.id === result.id ? { ...c, status: result.status } : c))\r\n    );\r\n  };\r\n\r\n  const pendentes = compartilhamentos.filter(c => c.status === \"pendente\");\r\n  const aceitos = compartilhamentos.filter(c => c.status === \"aceito\");\r\n  \r\n  return (\r\n    <div>\r\n      <button style={{ marginLeft: 10 }} onClick={() => setShareModalOpen(true)}>\r\n        ü§ù Compartilhar\r\n      </button>\r\n\r\n      <ShareModal\r\n        isOpen={shareModalOpen}\r\n        onClose={() => setShareModalOpen(false)}\r\n        setStatus={setStatus}\r\n      />\r\n\r\n      <h2>Solicita√ß√µes de compartilhamento</h2>\r\n      {pendentes.map(c => (\r\n        <CompartilhamentoItem\r\n          key={c.id}\r\n          arquivoNome={c.arquivo_nome}\r\n          senderNome={c.sender_nome}\r\n          onAceitar={() => handleAceitar(c.id)}\r\n          onRecusar={() => handleRecusar(c.id)}\r\n        />\r\n      ))}\r\n\r\n      <h2>Arquivos compartilhados com voc√™</h2>\r\n      {aceitos.map(c => (\r\n        <div key={c.id} style={{ display: \"flex\", alignItems: \"center\", gap: \"0.5rem\" }}>\r\n          <CompartilhamentoAceito\r\n            arquivoNome={c.arquivo_nome}\r\n            senderNome={c.sender_nome}\r\n          />\r\n          <button\r\n            onClick={() => {\r\n              const userKey = prompt(\"Informe a chave para descriptografar:\");\r\n              if (userKey) handleDownload(c, userKey, setStatus);\r\n            }}\r\n          >\r\n            Baixar\r\n          </button>\r\n        </div>\r\n      ))}\r\n\r\n      {status && <p>{status}</p>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;;;;;;;AAgBe,SAAS;IACtB,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,iNAAQ,EAAqB,EAAE;IACjF,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC;IACrD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAgB;IAEpE,MAAM,iBAAiB,CAAC;QACtB,kBAAkB;QAClB,kBAAkB;IACpB;IAEA,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe;YAAE,aAAa;QAAU,GAC3C,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI,IACpB,IAAI,CAAC,CAAA,OAAQ,qBAAqB;IACvC,GAAG,EAAE;IAEL,MAAM,gBAAgB,OAAO;QAC3B,MAAM,SAAS,MAAM,IAAA,gKAAuB,EAAC;QAC7C,qBAAqB,CAAA,OACnB,KAAK,GAAG,CAAC,CAAA,IAAM,EAAE,EAAE,KAAK,OAAO,EAAE,GAAG;oBAAE,GAAG,CAAC;oBAAE,QAAQ,OAAO,MAAM;gBAAC,IAAI;IAE1E;IAEA,MAAM,gBAAgB,OAAO;QAC3B,MAAM,SAAS,MAAM,IAAA,gKAAuB,EAAC;QAC7C,qBAAqB,CAAA,OACnB,KAAK,GAAG,CAAC,CAAA,IAAM,EAAE,EAAE,KAAK,OAAO,EAAE,GAAG;oBAAE,GAAG,CAAC;oBAAE,QAAQ,OAAO,MAAM;gBAAC,IAAI;IAE1E;IAEA,MAAM,YAAY,kBAAkB,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK;IAC7D,MAAM,UAAU,kBAAkB,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK;IAE3D,qBACE,8OAAC;;0BACC,8OAAC;gBAAO,OAAO;oBAAE,YAAY;gBAAG;gBAAG,SAAS,IAAM,kBAAkB;0BAAO;;;;;;0BAI3E,8OAAC,qJAAU;gBACT,QAAQ;gBACR,SAAS,IAAM,kBAAkB;gBACjC,WAAW;;;;;;0BAGb,8OAAC;0BAAG;;;;;;YACH,UAAU,GAAG,CAAC,CAAA,kBACb,8OAAC,+JAAoB;oBAEnB,aAAa,EAAE,YAAY;oBAC3B,YAAY,EAAE,WAAW;oBACzB,WAAW,IAAM,cAAc,EAAE,EAAE;oBACnC,WAAW,IAAM,cAAc,EAAE,EAAE;mBAJ9B,EAAE,EAAE;;;;;0BAQb,8OAAC;0BAAG;;;;;;YACH,QAAQ,GAAG,CAAC,CAAA,kBACX,8OAAC;oBAAe,OAAO;wBAAE,SAAS;wBAAQ,YAAY;wBAAU,KAAK;oBAAS;;sCAC5E,8OAAC,iKAAsB;4BACrB,aAAa,EAAE,YAAY;4BAC3B,YAAY,EAAE,WAAW;;;;;;sCAE3B,8OAAC;4BACC,SAAS;gCACP,MAAM,UAAU,OAAO;gCACvB,IAAI,SAAS,IAAA,yJAAc,EAAC,GAAG,SAAS;4BAC1C;sCACD;;;;;;;mBAVO,EAAE,EAAE;;;;;YAgBf,wBAAU,8OAAC;0BAAG;;;;;;;;;;;;AAGrB","debugId":null}}]
}