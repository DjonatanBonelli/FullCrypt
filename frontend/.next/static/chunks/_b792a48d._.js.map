{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djona/Programa%C3%A7%C3%A3o/full_crypt/frontend/app/crypto/hpke-kem.ts"],"sourcesContent":["import { Aes256Gcm, CipherSuite, HkdfSha256 } from \"@hpke/core\";\r\nimport { MlKem768 } from \"@hpke/ml-kem\";\r\n\r\n// === Encode / Decode base64url ===\r\nexport function b64uEncode(buf: Uint8Array) {\r\n  return Buffer.from(buf)\r\n    .toString(\"base64\")\r\n    .replace(/\\+/g, \"-\")\r\n    .replace(/\\//g, \"_\")\r\n    .replace(/=+$/, \"\");\r\n}\r\n\r\nexport function b64uDecode(s: string) {\r\n  return Uint8Array.from(Buffer.from(s.replace(/-/g, \"+\").replace(/_/g, \"/\"), \"base64\"));\r\n}\r\n\r\n// === Criar CipherSuite ===\r\nasync function makeSuite() {\r\n  return new CipherSuite({\r\n    kem: new MlKem768(),\r\n    kdf: new HkdfSha256(),\r\n    aead: new Aes256Gcm(),\r\n  });\r\n}\r\n\r\n// === Gerar par de chaves HPKE ===\r\nexport async function generateHpkeKeyPair() {\r\n  const suite = await makeSuite();\r\n  const { privateKey, publicKey } = await suite.kem.generateKeyPair();\r\n\r\n  console.log(\"Private Key:\", privateKey);\r\n  console.log(\"Public Key:\", publicKey);\r\n\r\n  // Pegamos apenas o Uint8Array interno\r\n  return {\r\n    privateKey: Array.from(privateKey.key),\r\n    publicKey: Array.from(publicKey.key),\r\n  };\r\n}\r\n\r\n// === Criptografa bytes com chave p칰blica (raw bytes) ===\r\nexport async function encryptBytesWithHpke(pubBytes: Uint8Array, plaintext: Uint8Array) {\r\n  const suite = await makeSuite();\r\n  const pk = await suite.kem.importKey(\"raw\", pubBytes, true); // public key raw\r\n  const sender = await suite.createSenderContext({ recipientPublicKey: pk });\r\n\r\n  const ciphertext = await sender.seal(plaintext);\r\n  const enc = sender.enc;\r\n\r\n  return {\r\n    enc: b64uEncode(enc),\r\n    ciphertext: ciphertext,\r\n    aead: \"Aes256Gcm\",\r\n    kem: \"MlKem768\",\r\n  };\r\n}\r\n\r\n// === Descriptografa bytes com chave privada (raw bytes) ===\r\nexport async function decryptBytesWithHpke(\r\n  privBytes: Uint8Array,\r\n  enc: Uint8Array,            \r\n  ciphertext: Uint8Array   \r\n) {\r\n\r\n  //console.log(privBytes.length, enc.length, ciphertext.length);\r\n  //console.log(enc);\r\n\r\n  const suite = await makeSuite();\r\n  const sk = await suite.kem.importKey(\"raw\", privBytes, false); \r\n\r\n  const recipient = await suite.createRecipientContext({\r\n    recipientKey: sk,\r\n    enc: enc,\r\n  });\r\n\r\n  const plaintext = await recipient.open(ciphertext); \r\n  return new Uint8Array(plaintext);\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAKS;AALT;AAAA;AAAA;AACA;AAAA;;;AAGO,SAAS,WAAW,GAAe;IACxC,OAAO,wKAAM,CAAC,IAAI,CAAC,KAChB,QAAQ,CAAC,UACT,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,OAAO;AACpB;AAEO,SAAS,WAAW,CAAS;IAClC,OAAO,WAAW,IAAI,CAAC,wKAAM,CAAC,IAAI,CAAC,EAAE,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM,MAAM;AAC9E;AAEA,4BAA4B;AAC5B,eAAe;IACb,OAAO,IAAI,wKAAW,CAAC;QACrB,KAAK,IAAI,yKAAQ;QACjB,KAAK,IAAI,uKAAU;QACnB,MAAM,IAAI,+KAAS;IACrB;AACF;AAGO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,MAAM,MAAM,GAAG,CAAC,eAAe;IAEjE,QAAQ,GAAG,CAAC,gBAAgB;IAC5B,QAAQ,GAAG,CAAC,eAAe;IAE3B,sCAAsC;IACtC,OAAO;QACL,YAAY,MAAM,IAAI,CAAC,WAAW,GAAG;QACrC,WAAW,MAAM,IAAI,CAAC,UAAU,GAAG;IACrC;AACF;AAGO,eAAe,qBAAqB,QAAoB,EAAE,SAAqB;IACpF,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,MAAM,MAAM,GAAG,CAAC,SAAS,CAAC,OAAO,UAAU,OAAO,iBAAiB;IAC9E,MAAM,SAAS,MAAM,MAAM,mBAAmB,CAAC;QAAE,oBAAoB;IAAG;IAExE,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC;IACrC,MAAM,MAAM,OAAO,GAAG;IAEtB,OAAO;QACL,KAAK,WAAW;QAChB,YAAY;QACZ,MAAM;QACN,KAAK;IACP;AACF;AAGO,eAAe,qBACpB,SAAqB,EACrB,GAAe,EACf,UAAsB;IAGtB,+DAA+D;IAC/D,mBAAmB;IAEnB,MAAM,QAAQ,MAAM;IACpB,MAAM,KAAK,MAAM,MAAM,GAAG,CAAC,SAAS,CAAC,OAAO,WAAW;IAEvD,MAAM,YAAY,MAAM,MAAM,sBAAsB,CAAC;QACnD,cAAc;QACd,KAAK;IACP;IAEA,MAAM,YAAY,MAAM,UAAU,IAAI,CAAC;IACvC,OAAO,IAAI,WAAW;AACxB","debugId":null}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djona/Programa%C3%A7%C3%A3o/full_crypt/frontend/app/login/handlers/userHandlers.ts"],"sourcesContent":["\"use client\";\r\nimport { b64uEncode, generateHpkeKeyPair } from \"../../crypto/hpke-kem\";\r\n\r\nexport const criarUsuario = async (nome: string, email: string, senha: string, setStatus?: (msg: string) => void) => {\r\n  try {\r\n    setStatus?.(\"游댐 Gerando chaves...\");\r\n\r\n    const { publicKey: hpkePub, privateKey: hpkePriv } =\r\n      await generateHpkeKeyPair();\r\n\r\n    const dil = await import(\"@/app/crypto/dilithium\");\r\n    const { publicKey: dPub, privateKey: dPriv } =\r\n      await dil.generateDilithiumKeyPair(2);\r\n\r\n    // manda pro backend\r\n    setStatus?.(\"游닋 Enviando dados...\");\r\n    const res = await fetch(\"/api/register\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        nome,\r\n        email,\r\n        senha,\r\n        pk_kyber: b64uEncode(Uint8Array.from(hpkePub)),\r\n        pk_dilithium: b64uEncode(Uint8Array.from(dPub)),\r\n      }),\r\n    });\r\n\r\n    if (!res.ok) throw new Error(\"Erro ao criar usu치rio\");\r\n\r\n    // montar arquivo 칰nico\r\n    const fileObj = {\r\n      kyber: {\r\n        public: b64uEncode(hpkePub),\r\n        private: b64uEncode(hpkePriv),\r\n      },\r\n      dilithium: {\r\n        public: b64uEncode(dPub),\r\n        private: b64uEncode(dPriv),\r\n      },\r\n    };\r\n\r\n    const blob = new Blob([JSON.stringify(fileObj, null, 2)], {\r\n      type: \"application/json\",\r\n    });\r\n\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = `${email}_keys.json`;\r\n    a.click();\r\n    a.remove();\r\n    URL.revokeObjectURL(url);\r\n\r\n    setStatus?.(\"Usu치rio criado! Arquivo de chaves baixado.\");\r\n  } catch (err) {\r\n    console.error(err);\r\n    setStatus?.(\"Erro ao criar usu치rio\");\r\n  }\r\n};\r\n"],"names":[],"mappings":";;;;AACA;AADA;;AAGO,MAAM,eAAe,OAAO,MAAc,OAAe,OAAe;IAC7E,IAAI;QACF,sBAAA,gCAAA,UAAY;QAEZ,MAAM,EAAE,WAAW,OAAO,EAAE,YAAY,QAAQ,EAAE,GAChD,MAAM,IAAA,sJAAmB;QAE3B,MAAM,MAAM;QACZ,MAAM,EAAE,WAAW,IAAI,EAAE,YAAY,KAAK,EAAE,GAC1C,MAAM,IAAI,wBAAwB,CAAC;QAErC,oBAAoB;QACpB,sBAAA,gCAAA,UAAY;QACZ,MAAM,MAAM,MAAM,MAAM,iBAAiB;YACvC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB;gBACA;gBACA;gBACA,UAAU,IAAA,6IAAU,EAAC,WAAW,IAAI,CAAC;gBACrC,cAAc,IAAA,6IAAU,EAAC,WAAW,IAAI,CAAC;YAC3C;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;QAE7B,uBAAuB;QACvB,MAAM,UAAU;YACd,OAAO;gBACL,QAAQ,IAAA,6IAAU,EAAC;gBACnB,SAAS,IAAA,6IAAU,EAAC;YACtB;YACA,WAAW;gBACT,QAAQ,IAAA,6IAAU,EAAC;gBACnB,SAAS,IAAA,6IAAU,EAAC;YACtB;QACF;QAEA,MAAM,OAAO,IAAI,KAAK;YAAC,KAAK,SAAS,CAAC,SAAS,MAAM;SAAG,EAAE;YACxD,MAAM;QACR;QAEA,MAAM,MAAM,IAAI,eAAe,CAAC;QAChC,MAAM,IAAI,SAAS,aAAa,CAAC;QACjC,EAAE,IAAI,GAAG;QACT,EAAE,QAAQ,GAAG,AAAC,GAAQ,OAAN,OAAM;QACtB,EAAE,KAAK;QACP,EAAE,MAAM;QACR,IAAI,eAAe,CAAC;QAEpB,sBAAA,gCAAA,UAAY;IACd,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,sBAAA,gCAAA,UAAY;IACd;AACF","debugId":null}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djona/Programa%C3%A7%C3%A3o/full_crypt/frontend/components/login/RegisterForm.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState } from \"react\";\r\nimport { criarUsuario } from \"../../app/login/handlers/userHandlers\";\r\n\r\nexport default function RegisterForm() {\r\n  const [nome, setNome] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [senha, setSenha] = useState(\"\");\r\n  const [status, setStatus] = useState(\"\");\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    await criarUsuario(nome, email, senha, setStatus);\r\n    setNome(\"\"); setEmail(\"\"); setSenha(\"\");\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2>Criar Usu치rio</h2>\r\n      <form onSubmit={handleSubmit}>\r\n        <input type=\"text\" placeholder=\"Nome\" value={nome} onChange={e => setNome(e.target.value)} required />\r\n        <input type=\"email\" placeholder=\"E-mail\" value={email} onChange={e => setEmail(e.target.value)} required />\r\n        <input type=\"password\" placeholder=\"Senha\" value={senha} onChange={e => setSenha(e.target.value)} required />\r\n        <button type=\"submit\">Criar</button>\r\n      </form>\r\n      {status && <p>{status}</p>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IAErC,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,MAAM,IAAA,2JAAY,EAAC,MAAM,OAAO,OAAO;QACvC,QAAQ;QAAK,SAAS;QAAK,SAAS;IACtC;IAEA,qBACE,6LAAC;;0BACC,6LAAC;0BAAG;;;;;;0BACJ,6LAAC;gBAAK,UAAU;;kCACd,6LAAC;wBAAM,MAAK;wBAAO,aAAY;wBAAO,OAAO;wBAAM,UAAU,CAAA,IAAK,QAAQ,EAAE,MAAM,CAAC,KAAK;wBAAG,QAAQ;;;;;;kCACnG,6LAAC;wBAAM,MAAK;wBAAQ,aAAY;wBAAS,OAAO;wBAAO,UAAU,CAAA,IAAK,SAAS,EAAE,MAAM,CAAC,KAAK;wBAAG,QAAQ;;;;;;kCACxG,6LAAC;wBAAM,MAAK;wBAAW,aAAY;wBAAQ,OAAO;wBAAO,UAAU,CAAA,IAAK,SAAS,EAAE,MAAM,CAAC,KAAK;wBAAG,QAAQ;;;;;;kCAC1G,6LAAC;wBAAO,MAAK;kCAAS;;;;;;;;;;;;YAEvB,wBAAU,6LAAC;0BAAG;;;;;;;;;;;;AAGrB;GAxBwB;KAAA","debugId":null}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djona/Programa%C3%A7%C3%A3o/full_crypt/frontend/app/login/handlers/authHandlers.ts"],"sourcesContent":["// loginHandler.ts\r\nexport const loginUsuario = async (\r\n  email: string,\r\n  senha: string,\r\n  router: any, // next/navigation router\r\n  setStatus?: (msg: string) => void\r\n) => {\r\n  try {\r\n    const res = await fetch(\"/api/login\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ email, senha }),\r\n      credentials: \"include\",\r\n    });\r\n\r\n    if (!res.ok) throw new Error(\"Credenciais inv치lidas\");\r\n\r\n    if (setStatus) setStatus(\"Login realizado com sucesso!\");\r\n    router.push(\"/cloud\"); // redireciona\r\n  } catch (err) {\r\n    console.error(err);\r\n    if (setStatus) setStatus(\"Erro ao realizar login\");\r\n  }\r\n};\r\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;AACX,MAAM,eAAe,OAC1B,OACA,OACA,QACA;IAEA,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,cAAc;YACpC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAO;YAAM;YACpC,aAAa;QACf;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;QAE7B,IAAI,WAAW,UAAU;QACzB,OAAO,IAAI,CAAC,WAAW,cAAc;IACvC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,IAAI,WAAW,UAAU;IAC3B;AACF","debugId":null}},
    {"offset": {"line": 290, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/djona/Programa%C3%A7%C3%A3o/full_crypt/frontend/components/login/LoginForm.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { loginUsuario } from \"../../app/login/handlers/authHandlers\";\r\n\r\nexport default function LoginForm() {\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [senha, setSenha] = useState(\"\");\r\n  const [status, setStatus] = useState(\"\");\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    await loginUsuario(email, senha, router, setStatus);\r\n    setEmail(\"\");\r\n    setSenha(\"\");\r\n  };\r\n\r\n\r\n  return (\r\n    <div>\r\n      <h2>Login</h2>\r\n      <form onSubmit={handleSubmit}>\r\n        <input type=\"email\" placeholder=\"E-mail\" value={email} onChange={e => setEmail(e.target.value)} required />\r\n        <input type=\"password\" placeholder=\"Senha\" value={senha} onChange={e => setSenha(e.target.value)} required />\r\n        <button type=\"submit\">Entrar</button>\r\n      </form>\r\n      {status && <p>{status}</p>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;AAHA;;;;AAKe,SAAS;;IACtB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IAErC,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,MAAM,IAAA,2JAAY,EAAC,OAAO,OAAO,QAAQ;QACzC,SAAS;QACT,SAAS;IACX;IAGA,qBACE,6LAAC;;0BACC,6LAAC;0BAAG;;;;;;0BACJ,6LAAC;gBAAK,UAAU;;kCACd,6LAAC;wBAAM,MAAK;wBAAQ,aAAY;wBAAS,OAAO;wBAAO,UAAU,CAAA,IAAK,SAAS,EAAE,MAAM,CAAC,KAAK;wBAAG,QAAQ;;;;;;kCACxG,6LAAC;wBAAM,MAAK;wBAAW,aAAY;wBAAQ,OAAO;wBAAO,UAAU,CAAA,IAAK,SAAS,EAAE,MAAM,CAAC,KAAK;wBAAG,QAAQ;;;;;;kCAC1G,6LAAC;wBAAO,MAAK;kCAAS;;;;;;;;;;;;YAEvB,wBAAU,6LAAC;0BAAG;;;;;;;;;;;;AAGrB;GAzBwB;;QACP,kJAAS;;;KADF","debugId":null}}]
}